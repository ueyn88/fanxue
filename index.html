<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>外国语小学放学记录</title>
    <style>
        /* --- 全局样式和重置 --- */
        :root {
            --primary-color: #007aff;
            --danger-color: #ff3b30;
            --card-bg: #ffffff;
            --body-bg: #f4f7f9;
            --text-color: #333333;
            --text-light: #888888;
            --border-color: #e0e0e0;
            --shadow-light: rgba(0, 0, 0, 0.08);
            --shadow-strong: rgba(0, 0, 0, 0.12);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--body-bg);
            color: var(--text-color);
            padding-bottom: 30px;
        }

        /* --- 页面头部 --- */
        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 15px;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(0, 122, 255, 0.3);
            margin-bottom: 20px;
        }

        .container {
            padding: 0 15px;
        }

        /* --- 年级分组 --- */
        .grade-section {
            margin-bottom: 25px;
        }

        .grade-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            padding-left: 5px;
            border-left: 4px solid var(--primary-color);
        }

        /* --- 班级卡片网格布局 --- */
        .class-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 12px;
        }

        /* --- 班级卡片样式 (关键修正) --- */
        .class-card {
            display: flex;
            align-items: center; /* <<< 关键修正：垂直居中对齐卡片内的所有直接子元素 */
            background-color: var(--card-bg);
            padding: 12px;
            min-height: 68px; /* 给予足够的高度以容纳两行文字 */
            border-radius: 10px;
            box-shadow: 0 2px 5px var(--shadow-light);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .class-card:active {
            transform: scale(0.97);
            box-shadow: 0 4px 10px var(--shadow-strong);
        }

        .class-card input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .card-content {
            display: flex;
            flex-direction: column;
            justify-content: center; /* 确保内容在自己的容器里也是居中的 */
            flex-grow: 1;
        }

        .class-name {
            font-size: 1em;
            font-weight: 500;
            transition: color 0.3s ease, text-decoration 0.3s ease;
        }
        
        /* --- 时间戳样式 (关键修正) --- */
        .timestamp {
            font-size: 0.75em;
            color: var(--text-light);
            margin-top: 4px;
            display: none; /* <<< 关键修正：默认不显示且不占空间 */
        }

        .checkmark {
            flex-shrink: 0;
            height: 22px;
            width: 22px;
            background-color: #f0f0f0;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 8px;
        }
        
        .checkmark::after {
            content: "";
            position: absolute;
            display: none;
            width: 6px;
            height: 12px;
            border: solid white;
            border-width: 0 3px 3px 0;
            transform: rotate(45deg) translate(-1px, -1px);
        }

        /* --- 勾选状态下的样式变化 (关键修正) --- */
        .class-card input:checked ~ .checkmark {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .class-card input:checked ~ .checkmark::after {
            display: block;
        }

        .class-card input:checked ~ .card-content .class-name {
            color: var(--text-light);
            text-decoration: line-through;
        }
        
        .class-card input:checked ~ .card-content .timestamp {
            display: block; /* <<< 关键修正：勾选时，让时间戳显示出来 */
        }

        /* --- 底部清除按钮区域 --- */
        .clear-section {
            margin-top: 40px;
            padding: 10px 15px;
            text-align: center;
        }

        #clear-button {
            background-color: var(--danger-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 30px;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
        }
        #clear-button:active {
            transform: scale(0.98);
            background-color: #d93025;
        }
    </style>
</head>
<body>

    <header class="header">
        外国语小学放学记录
    </header>

    <div class="container">
        <!-- HTML 结构部分没有改变，所有班级列表省略以节省篇幅，但它们都在下面的完整代码中 -->
        <!-- 一年级 -->
        <section class="grade-section">
            <h2 class="grade-title">一年级 (11个班)</h2>
            <div class="class-grid">
                <label class="class-card" for="g1c1"><input type="checkbox" id="g1c1"><div class="card-content"><span class="class-name">一年级一班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g1c2"><input type="checkbox" id="g1c2"><div class="card-content"><span class="class-name">一年级二班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g1c3"><input type="checkbox" id="g1c3"><div class="card-content"><span class="class-name">一年级三班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g1c4"><input type="checkbox" id="g1c4"><div class="card-content"><span class="class-name">一年级四班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g1c5"><input type="checkbox" id="g1c5"><div class="card-content"><span class="class-name">一年级五班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g1c6"><input type="checkbox" id="g1c6"><div class="card-content"><span class="class-name">一年级六班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g1c7"><input type="checkbox" id="g1c7"><div class="card-content"><span class="class-name">一年级七班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g1c8"><input type="checkbox" id="g1c8"><div class="card-content"><span class="class-name">一年级八班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g1c9"><input type="checkbox" id="g1c9"><div class="card-content"><span class="class-name">一年级九班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g1c10"><input type="checkbox" id="g1c10"><div class="card-content"><span class="class-name">一年级十班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g1c11"><input type="checkbox" id="g1c11"><div class="card-content"><span class="class-name">一年级十一班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
            </div>
        </section>

        <!-- 二年级 -->
        <section class="grade-section">
            <h2 class="grade-title">二年级 (11个班)</h2>
            <div class="class-grid">
                <label class="class-card" for="g2c1"><input type="checkbox" id="g2c1"><div class="card-content"><span class="class-name">二年级一班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g2c2"><input type="checkbox" id="g2c2"><div class="card-content"><span class="class-name">二年级二班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g2c3"><input type="checkbox" id="g2c3"><div class="card-content"><span class="class-name">二年级三班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g2c4"><input type="checkbox" id="g2c4"><div class="card-content"><span class="class-name">二年级四班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g2c5"><input type="checkbox" id="g2c5"><div class="card-content"><span class="class-name">二年级五班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g2c6"><input type="checkbox" id="g2c6"><div class="card-content"><span class="class-name">二年级六班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g2c7"><input type="checkbox" id="g2c7"><div class="card-content"><span class="class-name">二年级七班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g2c8"><input type="checkbox" id="g2c8"><div class="card-content"><span class="class-name">二年级八班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g2c9"><input type="checkbox" id="g2c9"><div class="card-content"><span class="class-name">二年级九班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g2c10"><input type="checkbox" id="g2c10"><div class="card-content"><span class="class-name">二年级十班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g2c11"><input type="checkbox" id="g2c11"><div class="card-content"><span class="class-name">二年级十一班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
            </div>
        </section>

        <!-- 三年级 -->
        <section class="grade-section">
            <h2 class="grade-title">三年级 (10个班)</h2>
            <div class="class-grid">
                <label class="class-card" for="g3c1"><input type="checkbox" id="g3c1"><div class="card-content"><span class="class-name">三年级一班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g3c2"><input type="checkbox" id="g3c2"><div class="card-content"><span class="class-name">三年级二班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g3c3"><input type="checkbox" id="g3c3"><div class="card-content"><span class="class-name">三年级三班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g3c4"><input type="checkbox" id="g3c4"><div class="card-content"><span class="class-name">三年级四班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g3c5"><input type="checkbox" id="g3c5"><div class="card-content"><span class="class-name">三年级五班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g3c6"><input type="checkbox" id="g3c6"><div class="card-content"><span class="class-name">三年级六班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g3c7"><input type="checkbox" id="g3c7"><div class="card-content"><span class="class-name">三年级七班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g3c8"><input type="checkbox" id="g3c8"><div class="card-content"><span class="class-name">三年级八班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g3c9"><input type="checkbox" id="g3c9"><div class="card-content"><span class="class-name">三年级九班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g3c10"><input type="checkbox" id="g3c10"><div class="card-content"><span class="class-name">三年级十班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
            </div>
        </section>

        <!-- 四年级 -->
        <section class="grade-section">
            <h2 class="grade-title">四年级 (10个班)</h2>
            <div class="class-grid">
                <label class="class-card" for="g4c1"><input type="checkbox" id="g4c1"><div class="card-content"><span class="class-name">四年级一班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g4c2"><input type="checkbox" id="g4c2"><div class="card-content"><span class="class-name">四年级二班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g4c3"><input type="checkbox" id="g4c3"><div class="card-content"><span class="class-name">四年级三班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g4c4"><input type="checkbox" id="g4c4"><div class="card-content"><span class="class-name">四年级四班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g4c5"><input type="checkbox" id="g4c5"><div class="card-content"><span class="class-name">四年级五班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g4c6"><input type="checkbox" id="g4c6"><div class="card-content"><span class="class-name">四年级六班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g4c7"><input type="checkbox" id="g4c7"><div class="card-content"><span class="class-name">四年级七班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g4c8"><input type="checkbox" id="g4c8"><div class="card-content"><span class="class-name">四年级八班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g4c9"><input type="checkbox" id="g4c9"><div class="card-content"><span class="class-name">四年级九班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g4c10"><input type="checkbox" id="g4c10"><div class="card-content"><span class="class-name">四年级十班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
            </div>
        </section>

        <!-- 五年级 -->
        <section class="grade-section">
            <h2 class="grade-title">五年级 (10个班)</h2>
            <div class="class-grid">
                <label class="class-card" for="g5c1"><input type="checkbox" id="g5c1"><div class="card-content"><span class="class-name">五年级一班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g5c2"><input type="checkbox" id="g5c2"><div class="card-content"><span class="class-name">五年级二班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g5c3"><input type="checkbox" id="g5c3"><div class="card-content"><span class="class-name">五年级三班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g5c4"><input type="checkbox" id="g5c4"><div class="card-content"><span class="class-name">五年级四班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g5c5"><input type="checkbox" id="g5c5"><div class="card-content"><span class="class-name">五年级五班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g5c6"><input type="checkbox" id="g5c6"><div class="card-content"><span class="class-name">五年级六班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g5c7"><input type="checkbox" id="g5c7"><div class="card-content"><span class="class-name">五年级七班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g5c8"><input type="checkbox" id="g5c8"><div class="card-content"><span class="class-name">五年级八班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g5c9"><input type="checkbox" id="g5c9"><div class="card-content"><span class="class-name">五年级九班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g5c10"><input type="checkbox" id="g5c10"><div class="card-content"><span class="class-name">五年级十班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
            </div>
        </section>
        
        <!-- 六年级 -->
        <section class="grade-section">
            <h2 class="grade-title">六年级 (8个班)</h2>
            <div class="class-grid">
                <label class="class-card" for="g6c1"><input type="checkbox" id="g6c1"><div class="card-content"><span class="class-name">六年级一班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g6c2"><input type="checkbox" id="g6c2"><div class="card-content"><span class="class-name">六年级二班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g6c3"><input type="checkbox" id="g6c3"><div class="card-content"><span class="class-name">六年级三班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g6c4"><input type="checkbox" id="g6c4"><div class="card-content"><span class="class-name">六年级四班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g6c5"><input type="checkbox" id="g6c5"><div class="card-content"><span class="class-name">六年级五班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g6c6"><input type="checkbox" id="g6c6"><div class="card-content"><span class="class-name">六年级六班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g6c7"><input type="checkbox" id="g6c7"><div class="card-content"><span class="class-name">六年级七班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
                <label class="class-card" for="g6c8"><input type="checkbox" id="g6c8"><div class="card-content"><span class="class-name">六年级八班</span><small class="timestamp"></small></div><span class="checkmark"></span></label>
            </div>
        </section>

        <!-- 页面底部的清除按钮 -->
        <div class="clear-section">
            <button id="clear-button">清除所有标记</button>
        </div>
    </div>

    <script>
        // JavaScript 部分无需修改，它已经是正确的
        document.addEventListener('DOMContentLoaded', () => {
            const STORAGE_KEY = 'classRecordsData_v3.1'; // 使用新键名避免与旧版数据冲突
            const allCheckboxes = document.querySelectorAll('input[type="checkbox"]');
            const clearButton = document.getElementById('clear-button');

            function formatTime(date) {
                const hours = String(date.getHours()).padStart(2, '0');
                const minutes = String(date.getMinutes()).padStart(2, '0');
                return `${hours}:${minutes}`;
            }

            function updateCardUI(checkbox, record) {
                const card = checkbox.closest('.class-card');
                const timestampEl = card.querySelector('.timestamp');
                
                if (record && record.checked) {
                    checkbox.checked = true;
                    const time = formatTime(new Date(record.timestamp));
                    timestampEl.textContent = `完成于 ${time}`;
                } else {
                    checkbox.checked = false;
                    timestampEl.textContent = '';
                }
            }

            function loadRecords() {
                const savedData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
                allCheckboxes.forEach(checkbox => {
                    const record = savedData[checkbox.id];
                    updateCardUI(checkbox, record);
                });
            }

            function saveRecord(checkbox) {
                const savedData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
                const id = checkbox.id;

                if (checkbox.checked) {
                    const now = new Date();
                    const newRecord = {
                        checked: true,
                        timestamp: now.toISOString()
                    };
                    savedData[id] = newRecord;
                    updateCardUI(checkbox, newRecord);
                } else {
                    delete savedData[id];
                    updateCardUI(checkbox, null);
                }

                localStorage.setItem(STORAGE_KEY, JSON.stringify(savedData));
            }

            function clearAllRecords() {
                if (confirm('您确定要清除所有班级的标记和时间记录吗？')) {
                    localStorage.removeItem(STORAGE_KEY);
                    allCheckboxes.forEach(checkbox => {
                        updateCardUI(checkbox, null);
                    });
                }
            }

            allCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', () => saveRecord(checkbox));
            });

            clearButton.addEventListener('click', clearAllRecords);

            loadRecords();
        });
    </script>

</body>
</html>